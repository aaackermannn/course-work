<section>
  <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>

  <tui-loader [showLoader]="loading" [overlay]="true">
    <ng-container *ngIf="!isAuthenticated">
      <tui-island size="l" appearance="warning">
        <div class="auth-required">
          <h3 style="margin-top: 0; color: var(--danger)">
            –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
          </h3>
          <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
          <div class="auth-buttons">
            <button
              tuiButton
              appearance="primary"
              size="m"
              (click)="showLoginForm()"
            >
              –í–æ–π—Ç–∏
            </button>
            <button
              tuiButton
              appearance="flat"
              size="m"
              (click)="showRegisterForm()"
            >
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
          </div>
        </div>
      </tui-island>
    </ng-container>

    <ng-container *ngIf="isAuthenticated && !showLogin && !showRegister">
      <tui-island size="l" style="margin-bottom: 24px">
        <h3 style="margin-top: 0; margin-bottom: 20px">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <div class="profile-section">
          <div class="profile-header">
            <div class="avatar-section">
              <img
                *ngIf="user && user.photoURL"
                [src]="user.photoURL"
                alt="Avatar"
                class="user-avatar"
              />
              <div *ngIf="!user || !user.photoURL" class="avatar-placeholder">
                <svg
                  width="32"
                  height="32"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
            </div>
            <div class="user-info">
              <div class="user-name">
                {{
                  user && user.displayName ? user.displayName : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                }}
              </div>
              <div class="user-email">
                {{ user && user.email ? user.email : 'Email –Ω–µ —É–∫–∞–∑–∞–Ω' }}
              </div>
            </div>
          </div>
        </div>
      </tui-island>

      <tui-island size="l" style="margin-bottom: 24px">
        <h3 style="margin-top: 0; margin-bottom: 20px">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Faceit</h3>
        <div class="faceit-section">
          <div class="form-group">
            <label>Faceit ID</label>
            <div class="form-description">
              –£–∫–∞–∂–∏—Ç–µ –≤–∞—à Faceit ID –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
              –∏ —Ü–µ–ª–µ–π
            </div>
            <div class="input-group">
              <tui-input
                [(ngModel)]="faceitId"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Faceit ID"
                size="l"
                class="faceit-input"
              >
                <span tuiInputIconLeft>üéÆ</span>
                Faceit ID
              </tui-input>
              <button
                tuiButton
                appearance="primary"
                size="m"
                (click)="saveFaceitId()"
                [disabled]="!faceitId || !faceitId.trim()"
              >
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
              </button>
            </div>
          </div>

          <div class="faceit-stats" *ngIf="playerStats">
            <h4 style="margin-top: 24px; margin-bottom: 16px">
              –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Faceit
            </h4>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-icon"></div>
                <div class="stat-value">
                  {{
                    playerStats?.kdRatio
                      ? (playerStats.kdRatio | number : '1.2-2')
                      : 'N/A'
                  }}
                </div>
                <div class="stat-label">K/D Ratio</div>
              </div>
              <div class="stat-item">
                <div class="stat-icon"></div>
                <div class="stat-value">
                  {{
                    playerStats?.winRatePercent
                      ? (playerStats.winRatePercent | number : '1.1-1') + '%'
                      : 'N/A'
                  }}
                </div>
                <div class="stat-label">Win Rate</div>
              </div>
              <div class="stat-item">
                <div class="stat-icon"></div>
                <div class="stat-value">
                  {{
                    playerStats?.matchesPlayed
                      ? (playerStats.matchesPlayed | number : '1.0-0')
                      : 'N/A'
                  }}
                </div>
                <div class="stat-label">Matches</div>
              </div>
            </div>
          </div>
        </div>
      </tui-island>

      <div class="logout-section">
        <button tuiButton appearance="error" size="m" (click)="signOut()">
          –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        </button>
      </div>
    </ng-container>

    <ng-container *ngIf="showLogin">
      <tui-island size="l">
        <h3 style="margin-top: 0; margin-bottom: 20px">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
        <div class="auth-form">
          <div class="form-group">
            <label>Email</label>
            <tui-input [(ngModel)]="email" placeholder="–í–≤–µ–¥–∏—Ç–µ email" size="l">
              Email
            </tui-input>
          </div>
          <div class="form-group">
            <label>–ü–∞—Ä–æ–ª—å</label>
            <tui-input
              [(ngModel)]="password"
              type="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              size="l"
            >
              –ü–∞—Ä–æ–ª—å
            </tui-input>
          </div>
          <div class="form-actions">
            <button
              tuiButton
              appearance="primary"
              size="m"
              (click)="signInWithEmail()"
            >
              –í–æ–π—Ç–∏
            </button>
            <button tuiButton appearance="flat" size="m" (click)="backToMain()">
              –ù–∞–∑–∞–¥
            </button>
          </div>
        </div>
      </tui-island>
    </ng-container>

    <ng-container *ngIf="showRegister">
      <tui-island size="l">
        <h3 style="margin-top: 0; margin-bottom: 20px">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
        <div class="auth-form">
          <div class="form-group">
            <label>Email</label>
            <tui-input [(ngModel)]="email" placeholder="–í–≤–µ–¥–∏—Ç–µ email" size="l">
              Email
            </tui-input>
          </div>
          <div class="form-group">
            <label>–ü–∞—Ä–æ–ª—å</label>
            <tui-input
              [(ngModel)]="password"
              type="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              size="l"
            >
              –ü–∞—Ä–æ–ª—å
            </tui-input>
          </div>
          <div class="form-group">
            <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
            <tui-input
              [(ngModel)]="confirmPassword"
              type="password"
              placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              size="l"
            >
              –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
            </tui-input>
          </div>
          <div class="form-actions">
            <button
              tuiButton
              appearance="primary"
              size="m"
              (click)="signUpWithEmail()"
              [disabled]="!canRegister"
            >
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
            <button tuiButton appearance="flat" size="m" (click)="backToMain()">
              –ù–∞–∑–∞–¥
            </button>
          </div>
        </div>
      </tui-island>
    </ng-container>
  </tui-loader>
</section>
