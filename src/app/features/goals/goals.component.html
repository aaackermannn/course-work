<section>
  <h2>–¶–µ–ª–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>

  <tui-loader [showLoader]="loading" [overlay]="true">
    <ng-container *ngIf="!isAuthenticated">
      <tui-island size="l" appearance="warning">
        <div class="auth-required">
          <h3 style="margin-top: 0; color: var(--danger)">
            –í–æ–π–¥–∏—Ç–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ü–µ–ª—è–º
          </h3>
          <p>
            –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ü–µ–ª–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∏
            —É–∫–∞–∑–∞—Ç—å Faceit ID.
          </p>
          <div class="auth-buttons">
            <button tuiButton appearance="primary" size="m" (click)="signIn()">
              –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
            </button>
            <button tuiButton appearance="flat" size="m" routerLink="/account">
              –ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
            </button>
          </div>
        </div>
      </tui-island>
    </ng-container>

    <ng-container *ngIf="isAuthenticated && !hasFaceitId">
      <tui-island size="l" appearance="warning">
        <div class="faceit-required">
          <h3 style="margin-top: 0; color: var(--warning)">
            –¢—Ä–µ–±—É–µ—Ç—Å—è Faceit ID
          </h3>
          <p>
            –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ü–µ–ª–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å
            –≤–∞—à Faceit ID –≤ –ø—Ä–æ—Ñ–∏–ª–µ.
          </p>
          <button tuiButton appearance="primary" size="m" routerLink="/account">
            –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å
          </button>
        </div>
      </tui-island>
    </ng-container>

    <ng-container *ngIf="isAuthenticated && hasFaceitId">
      <tui-island size="l" style="margin-bottom: 24px">
        <h3 style="margin-top: 0; margin-bottom: 24px">
          –í–∞—à–∞ —Ç–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </h3>
        <div class="player-stats" *ngIf="playerStats">
          <div class="stat-card">
            <div class="stat-icon"></div>
            <div class="stat-value">
              {{ playerStats.kdRatio | number : '1.2-2' }}
            </div>
            <div class="stat-label">K/D Ratio</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"></div>
            <div class="stat-value">
              {{ playerStats.winRatePercent | number : '1.1-1' }}%
            </div>
            <div class="stat-label">Win Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon"></div>
            <div class="stat-value">
              {{ playerStats.matchesPlayed | number }}
            </div>
            <div class="stat-label">Matches</div>
          </div>
        </div>
      </tui-island>

      <tui-island size="l" style="margin-bottom: 24px">
        <h3 style="margin-top: 0; margin-bottom: 24px">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å</h3>
        <div class="goal-form">
          <div class="form-row">
            <div class="form-group">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
              <tui-input
                [(ngModel)]="title"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ—Å—Ç–∏—á—å –≤–∏–Ω—Ä–µ–π—Ç 60%"
                size="l"
              >
                –ù–∞–∑–≤–∞–Ω–∏–µ
              </tui-input>
            </div>
            <div class="form-group">
              <label>–ú–µ—Ç—Ä–∏–∫–∞</label>
              <select [(ngModel)]="metric" class="form-select" size="l">
                <option value="winrate">Win Rate %</option>
                <option value="matches">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π</option>
                <option value="kd">K/D Ratio</option>
              </select>
            </div>
            <div class="form-group">
              <label>–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
              <tui-input
                [(ngModel)]="target"
                type="number"
                placeholder="60"
                size="l"
              >
                –¶–µ–ª—å
              </tui-input>
            </div>
          </div>
          <div class="form-actions">
            <button
              tuiButton
              appearance="primary"
              size="l"
              type="button"
              (click)="add()"
              [disabled]="!canAdd"
            >
              –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å
            </button>
            <button
              tuiButton
              appearance="flat"
              size="l"
              type="button"
              (click)="clearForm()"
            >
              –û—á–∏—Å—Ç–∏—Ç—å
            </button>
          </div>
        </div>
      </tui-island>

      <tui-island size="m" style="margin-bottom: 20px">
        <div class="filter-section">
          <div class="filter-row">
            <tui-input
              [ngModel]="filter"
              (ngModelChange)="onFilter($event)"
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ü–µ–ª–∏..."
              size="l"
              class="search-input"
            >
              <span tuiInputIconLeft> –ü–æ–∏—Å–∫ </span>
            </tui-input>
            <button
              tuiButton
              appearance="flat"
              size="l"
              (click)="clearFilter()"
            >
              –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
            </button>
          </div>
        </div>
      </tui-island>

      <tui-island size="l" *ngIf="goals.length">
        <h3 style="margin-top: 0; margin-bottom: 24px">–ú–æ–∏ —Ü–µ–ª–∏</h3>

        <div class="table-container">
          <table class="goals-table">
            <thead>
              <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–¶–µ–ª—å</th>
                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                <th class="actions-header" style="text-align: right">
                  –î–µ–π—Å—Ç–≤–∏—è
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let g of paged" class="goal-row">
                <td>
                  <div class="goal-title">{{ g.title }}</div>
                </td>
                <td>
                  <div class="target-value">{{ g.target || '-' }}</div>
                </td>
                <td>
                  <div class="progress-section">
                    <div class="progress-bar">
                      <div
                        class="progress-fill"
                        [style.width.%]="getProgressPercent(g)"
                      ></div>
                    </div>
                    <div class="progress-text">
                      {{ getCurrentValue(g) }} / {{ g.target }}
                      <span class="progress-percent"
                        >({{ getProgressPercent(g) | number : '1.0-0' }}%)</span
                      >
                    </div>
                  </div>
                </td>
                <td class="actions-cell">
                  <div class="actions">
                    <button
                      tuiButton
                      size="s"
                      appearance="flat"
                      (click)="editGoal(g)"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button
                      tuiButton
                      size="s"
                      appearance="error"
                      (click)="deleteGoal(g)"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination-container">
          <button
            class="pagination-btn"
            [disabled]="page === 0"
            (click)="page = page - 1"
          >
            ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è
          </button>

          <div class="pagination-numbers">
            <button
              *ngFor="let pageNum of getPaginationArray()"
              class="pagination-number"
              [class.active]="page === pageNum"
              [class.separator]="pageNum === -1"
              [disabled]="pageNum === -1"
              (click)="pageNum !== -1 && (page = pageNum)"
            >
              {{ pageNum === -1 ? '...' : pageNum + 1 }}
            </button>
          </div>

          <button
            class="pagination-btn"
            [disabled]="page === totalPages - 1"
            (click)="page = page + 1"
          >
            –°–ª–µ–¥—É—é—â–∞—è ‚Üí
          </button>
        </div>
      </tui-island>

      <tui-island size="l" *ngIf="!goals.length">
        <div class="no-goals">
          <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ü–µ–ª–µ–π.</p>
          <p>
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ü–µ–ª—å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–π
            –ø—Ä–æ–≥—Ä–µ—Å—Å.
          </p>
        </div>
      </tui-island>
    </ng-container>
  </tui-loader>
</section>
