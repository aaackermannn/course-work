<section>
  <h2>–õ–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</h2>

  <tui-loader [showLoader]="loading" [overlay]="true">
    <ng-container *ngIf="!isAuthenticated">
      <tui-island size="l" appearance="warning">
        <div class="auth-required">
          <h3 style="margin-top: 0; color: var(--danger)">
            –í–æ–π–¥–∏—Ç–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–º–µ—Ç–∫–∞–º
          </h3>
          <p>–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.</p>
          <div class="auth-buttons">
            <button tuiButton appearance="primary" size="m" routerLink="/account">
              –í–æ–π—Ç–∏
            </button>
          </div>
        </div>
      </tui-island>
    </ng-container>

    <ng-container *ngIf="isAuthenticated">
      <tui-island size="l" style="margin-bottom: 24px">
        <h3 style="margin-top: 0; margin-bottom: 24px">
          –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É
        </h3>
        <div class="note-form">
          <div class="form-row">
            <div class="form-group">
              <label>–¢–∏–ø –∑–∞–º–µ—Ç–∫–∏</label>
              <select [(ngModel)]="type" class="form-select" size="l">
                <option
                  *ngFor="let option of typeOptions"
                  [value]="option.value"
                >
                  {{ option.label }}
                </option>
              </select>
            </div>
            <div class="form-group full-width">
              <label>–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏</label>
              <tui-input
                [(ngModel)]="text"
                placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è..."
                size="l"
              >
                –ó–∞–º–µ—Ç–∫–∞
              </tui-input>
            </div>
          </div>
          <div class="form-actions">
            <button
              tuiButton
              appearance="primary"
              size="m"
              (click)="add()"
              [disabled]="!canAdd"
            >
              –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
            </button>
            <button
              tuiButton
              appearance="flat"
              size="l"
              type="button"
              (click)="clearForm()"
            >
              {{ editingNote ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–û—á–∏—Å—Ç–∏—Ç—å' }}
            </button>
          </div>
        </div>
      </tui-island>

      <tui-island size="m" style="margin-bottom: 20px">
        <div class="filter-section">
          <div class="filter-row">
            <tui-input
              [ngModel]="filter"
              (ngModelChange)="onFilter($event)"
              placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –∑–∞–º–µ—Ç–∫–∏..."
              size="l"
              class="search-input"
            >
              –ü–æ–∏—Å–∫
            </tui-input>
            <button
              tuiButton
              appearance="flat"
              size="l"
              (click)="clearFilter()"
            >
              –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
            </button>
          </div>
        </div>
      </tui-island>

      <tui-island size="l" *ngIf="notes.length">
        <h3 style="margin-top: 0; margin-bottom: 24px">–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h3>

        <div class="table-container">
          <table class="notes-table">
            <thead>
              <tr>
                <th class="date-header">–î–∞—Ç–∞</th>
                <th class="type-header">–¢–∏–ø</th>
                <th class="text-header">–¢–µ–∫—Å—Ç</th>
                <th class="actions-header">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let n of paged" class="note-row">
                <td class="date-cell">
                  <div class="note-date">
                    <div class="date-day">{{ n.createdAt | date : 'dd' }}</div>
                    <div class="date-month">
                      {{ n.createdAt | date : 'MMM' }}
                    </div>
                    <div class="date-time">
                      {{ n.createdAt | date : 'HH:mm' }}
                    </div>
                  </div>
                </td>
                <td class="type-cell">
                  <div class="note-type">
                    {{ n.type === 'match' ? '–ú–∞—Ç—á' : '–¢–∏–º–º–µ–π—Ç' }}
                  </div>
                </td>
                <td class="text-cell">
                  <div class="note-text">{{ n.text }}</div>
                </td>
                <td class="actions-cell">
                  <div class="actions">
                    <button
                      tuiButton
                      size="s"
                      appearance="flat"
                      (click)="editNote(n)"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button
                      tuiButton
                      size="s"
                      appearance="error"
                      (click)="deleteNote(n)"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination-container">
          <button
            class="pagination-btn"
            [disabled]="page === 0"
            (click)="page = page - 1"
          >
            ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è
          </button>

          <div class="pagination-numbers">
            <button
              *ngFor="let pageNum of getPaginationArray()"
              class="pagination-number"
              [class.active]="page === pageNum"
              [class.separator]="pageNum === -1"
              [disabled]="pageNum === -1"
              (click)="pageNum !== -1 && (page = pageNum)"
            >
              {{ pageNum === -1 ? '...' : pageNum + 1 }}
            </button>
          </div>

          <button
            class="pagination-btn"
            [disabled]="page === totalPages - 1"
            (click)="page = page + 1"
          >
            –°–ª–µ–¥—É—é—â–∞—è ‚Üí
          </button>
        </div>
      </tui-island>

      <tui-island size="l" *ngIf="!notes.length">
        <div class="no-notes">
          <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ç–æ–∫.</p>
          <p>
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–º–µ—Ç–∫—É –æ –º–∞—Ç—á–∞—Ö –∏–ª–∏
            —Ç–∏–º–º–µ–π—Ç–∞—Ö.
          </p>
        </div>
      </tui-island>
    </ng-container>
  </tui-loader>
</section>
